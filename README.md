# 🔍 PE Analyzer - Εργαλείο Ανάλυσης Εκτελέσιμων Αρχείων Windows

## 📌 Τι είναι τα PE αρχεία;

Τα PE (Portable Executable) είναι η κύρια μορφή εκτελέσιμων αρχείων στο λειτουργικό σύστημα Windows. Περιλαμβάνουν αρχεία όπως `.exe`, `.dll`, `.sys`, κ.ά.  
Περιέχουν πληροφορίες για την εκτέλεση του προγράμματος, sections με κώδικα και δεδομένα, πίνακες imports/exports, headers και metadata.

Η ανάλυση PE αρχείων είναι σημαντική για:
- Ανίχνευση malware
- Reverse engineering
- Κατανόηση της συμπεριφοράς ενός εκτελέσιμου

---

## 🧰 Τι κάνει αυτό το εργαλείο;

Αυτό το εργαλείο εκτελεί **στατική ανάλυση** σε αρχεία PE και παρέχει:
- Εξαγωγή strings (floss)
- Ανίχνευση ύποπτων imports & συναρτήσεων
- Ανάλυση sections (π.χ. RWX flags)
- VirusTotal lookup για hash
- Αναφορά με χρήσιμα ευρήματα για έλεγχο κακόβουλης συμπεριφοράς

---

## Λειτουργίες

- ✅ **Αναγνώριση αρχιτεκτονικής και χρόνου μεταγλώττισης του αρχείου**

  🛠️ Τι κάνει:

    Η συνάρτηση επιστρέφει κρίσιμες πληροφορίες σχετικά με:
    - Τον τύπο αρχιτεκτονικής του αρχείου (32-bit ή 64-bit),
    - Το imphash (ένα hash βασισμένο στις εισαγόμενες συναρτήσεις),
    - Τον χρόνο μεταγλώττισης (compile time),
    - (Προαιρετικά) όλες τις πληροφορίες του PE αρχείου.Αυτές οι πληροφορίες παρέχονται ανάλογα με το τι όρισμα (--IMPHASH, --BIT, --COMPILE, --DETAILS, --REPORT) έχει δώσει ο χρήστης μέσω argparse.
      
  🧠 Γιατί είναι χρήσιμη:

    - Imphash: Είναι χρήσιμο για σύγκριση αρχείων — αρχεία με τον ίδιο imphash πιθανόν έχουν παρόμοια συμπεριφορά ή κοινή προέλευση.
    - Αρχιτεκτονική: Σου λέει αν το αρχείο είναι 32-bit ή 64-bit, κάτι που καθορίζει με ποια εργαλεία θα το αναλύσεις ή τρέξεις.
    - Compile Time: Μπορεί να αποκαλύψει πότε δημιουργήθηκε το αρχείο — οι κακόβουλοι συντάκτες συχνά πειράζουν την ώρα για να κρύψουν την πραγματική τους δραστηριότητα.
    - REPORT mode: Παρέχει συνοπτική αναφορά με όλες τις παραπάνω πληροφορίες.
  
  ```bash
  python pe_analysis.py -f test.exe --bit
  ```

- ✅ **Υπολογισμός κατακερματισμένων τιμών (md5, sha1, sha256, imphash)**
  ```bash
  python pe_analysis.py -f test.exe -md5 -sha1 -sha256 -imp
  ```

- ✅ **Έλεγχος VirusTotal με χρήση API key**
  ```bash
  python pe_analysis.py -f test.exe -v <VIRUSTOTAL_API_KEY>
  ```

- ✅ **Ανάλυση των sections του αρχείου**

   🔍 Τι ελέγχει:

    - Όνομα του section (π.χ. .text, .data, .rsrc)

    - MD5 και SHA-256 hash του περιεχομένου του section

    - Εντροπία του section (δείχνει πόσο "τυχαίο" φαίνεται το περιεχόμενο)

        Αν η τιμή εντροπίας ≥ 7, αυτό συνήθως υποδηλώνει κρυπτογραφημένα ή συμπιεσμένα δεδομένα.

    - Αν το section είναι εκτελέσιμο (δηλ. αν μπορεί να περιέχει κώδικα)

  🧠 Γιατί είναι χρήσιμη:
  
    Επιτρέπει τον εντοπισμό ύποπτων sections, π.χ. με πολύ υψηλή εντροπία που πιθανώς περιέχουν obfuscated ή packed κώδικα.
    Η παρουσία εκτελέσιμων sections με υψηλή εντροπία είναι συχνή σε κακόβουλα αρχεία και μπορεί να σηματοδοτεί προσπάθεια απόκρυψης κακόβουλου λογισμικού.
    Τα hashes βοηθούν στον έλεγχο ακεραιότητας ή στο συγκριτικό έλεγχο με βάσεις δεδομένων malware (π.χ. VirusTotal).
    Παρέχει συνοπτική και οργανωμένη εικόνα του τρόπου με τον οποίο είναι δομημένο το αρχείο.
    
  ```bash
  python pe_analysis.py -f test.exe --section_data
  ```

- ✅ **Εντοπισμός γνωστών packers μέσω ονομάτων sections**

  Η εντολή προσπαθεί να εντοπίσει αν το PE αρχείο έχει "πακεταριστεί" (packed) με τη χρήση γνωστών packer εργαλείων, αναλύοντας τα ονόματα των sections.
  🛠️ Τι κάνει:
    - Διαβάζει από ένα αρχείο packers_sections.csv, το οποίο περιέχει γνωστά ονόματα sections που χρησιμοποιούνται από packer προγράμματα (π.χ. UPX, ASPack, Themida).
    - Ελέγχει αν το PE αρχείο που εξετάζουμε περιέχει sections με αυτά τα ονόματα.
    - Αν βρει κάποιο ύποπτο section, το αναφέρει ως πιθανό δείγμα χρήσης packer.
  
  🧠 Γιατί είναι χρήσιμη:
  
    - Τα packed αρχεία συχνά χρησιμοποιούνται για να αποκρύψουν κακόβουλο κώδικα, κάνοντάς τα πιο δύσκολα στην ανάλυση.
    - Η αναγνώριση packers μπορεί να σε βοηθήσει να αποφασίσεις αν πρέπει πρώτα να κάνεις unpack το αρχείο, πριν προχωρήσεις σε περαιτέρω στατική  ή δυναμική ανάλυση.
    - Σου δίνει άμεσες ενδείξεις για το αν το αρχείο έχει τροποποιηθεί ή έχει υποστεί "θάψιμο" του αρχικού κώδικα.
      
  ```bash
  python pe_analysis.py -f test.exe -p
  ```

- ✅ **Αναγνώριση μη συνηθισμένων section names**
  
  🛠️ Τι κάνει:
    - Ελέγχει τα ονόματα των sections (όπως .text, .data, .rsrc) μέσα στο PE αρχείο.
    - Συγκρίνει τα ονόματα αυτά με μια λίστα από γνωστά/συνηθισμένα section names.
    - Εάν βρει μη αναμενόμενα ή περίεργα ονόματα, τα επισημαίνει ως ύποπτα.

  🧠 Γιατί είναι χρήσιμο:
  
    - Τα κακόβουλα προγράμματα τροποποιούν ή προσθέτουν sections με περίεργα ονόματα (π.χ. .xyz, .upx0, .asdf) για να κρύψουν κακόβουλο κώδικα.
    - Μπορεί να αποτελέσει ένδειξη πακεταρισμένου ή τροποποιημένου αρχείου.
    - Αποτελεί ένα πρώτο βήμα στατικής ανάλυσης για την ανίχνευση ενδείξεων αλλοίωσης.
  
  ```bash
  python pe_analysis.py -f test.exe -u
  ```

- ✅ **Εξαγωγή συμβολοσειρών**
  ```bash
  python pe_analysis.py -f test.exe -s
  ```

- ✅ **Εντοπισμός ενδιαφερουσών συμβολοσειρών (IP, URL, MAC, emails, registry keys κ.ά.)**
  
  🛠️ Αυτή η συνάρτηση αναλύει ένα αρχείο και εντοπίζει «ενδιαφέρουσες» συμβολοσειρές που μπορεί να αποκαλύψουν κακόβουλη ή ύποπτη συμπεριφορά, όπως:
  
    - IPv4 & IPv6 διευθύνσεις (π.χ. 192.168.0.1)
    - URLs (π.χ. http://malicious.site)
    - Email διευθύνσεις (π.χ. hacker@evilcorp.com)
    - MAC addresses (π.χ. 00:0a:95:9d:68:16)
    - Domain names (π.χ. bad-domain.org)
    - Registry keys των Windows (π.χ. HKEY_LOCAL_MACHINE\Software...\Run)

  🧠 Γιατί είναι χρήσιμη:
    - Βοηθά στην αναγνώριση πιθανής κακόβουλης δικτυακής επικοινωνίας.
    - Μπορεί να αποκαλύψει στοιχεία στόχων ή υποδομών που χρησιμοποιεί το αρχείο.
    - Αναδεικνύει πιθανές παρεμβάσεις στο σύστημα, όπως τροποποιήσεις σε registry.
    - Είναι εξαιρετικά χρήσιμη για reverse engineering και ανάλυση κακόβουλου λογισμικού, καθώς παρέχει στοιχεία χωρίς αποσυμβολοποίηση.
    
  ```bash
  python pe_analysis.py -f test.exe --intresting
  ```

- ✅ **Χρήση του floss για ανάκτηση κρυφών ή obfuscated strings**
  (απαιτεί εγκατεστημένο το floss)
  
  🛠️ Τι κάνει:

    - Εκτελεί το εργαλείο floss πάνω στο αρχείο .exe.
    - Αντλεί κρυφές, αποκρυπτογραφημένες ή δυσδιάκριτες συμβολοσειρές (strings).
    - Το floss μπορεί να αναλύσει κώδικα που περιέχει strings τα οποία δεν είναι εμφανή μέσω απλής ανάλυσης με strings ή re.findall.
      
  🧠 Γιατί είναι χρήσιμο:

    - Πολλά malware κρύβουν strings (π.χ. URLs, εντολές, ονόματα αρχείων) για να αποφύγουν την ανίχνευση.
    - Το floss χρησιμοποιεί στατική ανάλυση και heuristics για να βρει strings που προκύπτουν δυναμικά κατά την εκτέλεση.
    - Βοηθά στην καλύτερη κατανόηση της λειτουργίας ενός κακόβουλου αρχείου, ακόμα και χωρίς εκτέλεση.
  
  ```bash
  python pe_analysis.py -f test.exe --floss
  ```

- ✅ **Λίστα με βιβλιοθήκες και συναρτήσεις που εισάγει το αρχείο**

  🛠️ Τι κάνει:

    - Επισημαίνει «ύποπτες» συναρτήσεις που χρησιμοποιούνται συχνά από malware.
    - Ο πίνακας IAT ενός PE αρχείου αποκαλύπτει ποιες συναρτήσεις του Windows API χρησιμοποιεί το πρόγραμμα.
    - Ελέγχει τις εισαγόμενες συναρτήσεις (imports) του PE αρχείου (μέσω του πίνακα ΙΑΤ – Import Address Table).
    - Αν βρει κάποια από τις ύποπτες συναρτήσεις, την εμφανίζει μαζί με περιγραφή γιατί θεωρείται ύποπτη.

  🧠 Γιατί είναι χρήσιμη:

    - Οι εισαγόμενες συναρτήσεις είναι συχνά αποκαλυπτικές για την πρόθεση του αρχείου.
    - Αν για παράδειγμα εισάγει συναρτήσεις για επικοινωνία με το διαδίκτυο, δημιουργία διεργασιών, τροποποίηση μνήμης, αυτό μπορεί να δείχνει κακόβουλη συμπεριφορά.
    - Μπορεί να εντοπίσει τεχνικές που χρησιμοποιούν malware, όπως process injection, keylogging, κτλ.
    - Ιδανική για ανάλυση malware σε αρχικό στάδιο, χωρίς να χρειάζεται να εκτελέσεις το αρχείο.
  
  
  ```bash
  python pe_analysis.py -f test.exe -i
  ```

- ✅ **Αυτόματη δημιουργία αναφοράς και αποθήκευση σε αρχείο**
  ```bash
  python pe_analysis.py -f test.exe -r -o report.txt
  ```

---

## Παραδείγματα Συνδυαστικής Εκτέλεσης

```bash
python pe_analysis.py -f test.exe --bit -md5 -sha1 --section_data -s --intresting -r -o final_report.txt
```

---


Εγκατάσταση:

```bash
pip install -r requirements.txt
```

---

